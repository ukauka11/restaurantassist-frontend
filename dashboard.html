<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RestaurantAssist • Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css">
  <style>
    /* Dashboard-only polish (keeps styles.css clean) */

    .hero {
      margin-top: 18px;
      padding: 22px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      background:
        radial-gradient(1200px 400px at 10% 0%, rgba(56,189,248,0.18), transparent 55%),
        radial-gradient(900px 380px at 90% 10%, rgba(34,197,94,0.16), transparent 55%),
        #0b1224;
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
    }
    .hero h1{
      margin:0;
      font-size: 34px;
      letter-spacing: -0.3px;
      color:#fff;
    }
    .hero .sub{
      margin-top: 10px;
      font-size: 14px;
      color:#cbd5e1;
      max-width: 900px;
      line-height: 1.6;
    }

    .grid {
      margin-top: 16px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .row2 {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 900px){
      .row2{ grid-template-columns: 1fr; }
    }

    .sectionTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 10px;
    }
    .sectionTitle h2{
      margin:0;
      font-size: 18px;
      color:#e2e8f0;
    }
    .hint{
      font-size: 12px;
      color:#94a3b8;
    }

    label{
      display:block;
      font-size: 13px;
      color:#94a3b8;
      margin: 10px 0 6px;
    }
    input{
      width:100%;
      box-sizing:border-box;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: #0a1020;
      color:#e5e7eb;
      outline:none;
    }
    input:focus{ border-color: rgba(56,189,248,0.8); }

    .actions{
      margin-top: 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 12px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color:#cbd5e1;
    }
    .pill.ok{
      border-color: rgba(34,197,94,0.35);
      background: rgba(34,197,94,0.12);
      color:#bbf7d0;
    }
    .pill.warn{
      border-color: rgba(148,163,184,0.35);
      background: rgba(148,163,184,0.10);
      color:#e2e8f0;
    }

    .kv{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 18px;
      margin-top: 10px;
    }
    @media (max-width: 700px){
      .kv{ grid-template-columns: 1fr; }
    }
    .k{ color:#94a3b8; font-size: 12px; margin-bottom: 4px; }
    .v{ color:#e5e7eb; font-weight: 800; }

    pre.code{
      margin: 10px 0 0 0;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.08);
      background: #070b16;
      color:#cbd5e1;
      overflow:auto;
      font-size: 12px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Toast */
    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(2,6,23,0.85);
      color:#e5e7eb;
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
      font-weight: 800;
      font-size: 13px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms ease;
    }
    .toast.show{ opacity: 1; }
    code{ background: rgba(255,255,255,0.06); padding: 2px 6px; border-radius: 6px; }
  </style>
</head>

<body>
  <div class="container">

    <!-- NAV -->
    <div class="nav">
      <div class="brand"><div class="dot"></div><span>RestaurantAssist</span></div>
      <div class="navlinks">
        <a class="btn" href="/">Home</a>
        <a class="btn" href="/dashboard.html">Dashboard</a>
        <a class="btn" href="/docs.html">Docs</a>
        <a class="btn" href="mailto:support@restaurantassist.app">Support</a>
      </div>
    </div>

    <!-- HERO -->
    <div class="hero">
      <h1>Dashboard</h1>
      <div class="sub">
        Paste your API key to load your account details and copy working examples.
        If your status becomes <code>past_due</code> or <code>canceled</code>, API requests will return <code>402</code>.
      </div>
    </div>

    <div class="grid">

      <!-- CONNECT -->
      <div class="card">
        <div class="sectionTitle">
          <h2>1) Connect</h2>
          <div id="pill" class="pill warn">● Not connected</div>
        </div>

        <div class="row2">
          <div>
            <label>API Base URL</label>
            <input id="apiBase" value="https://review-assistant-api.onrender.com" />
            <div class="hint" style="margin-top:8px;">
              Tip: if you later set up <code>api.restaurantassist.app</code>, update this value.
            </div>
          </div>

          <div>
            <label>Your API Key (<code>x-api-key</code>)</label>
            <input id="apiKey" placeholder="cust_..." />
            <div class="hint" style="margin-top:8px;">
              We emailed this after checkout. If you didn’t get it, check Spam and click “Not spam”.
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="loadBtn">Load my account</button>
          <button class="btn" id="saveBtn">Save key locally</button>
          <button class="btn" id="clearBtn">Clear saved key</button>
          <button class="btn" id="copyBtn">Copy API key</button>
        </div>

        <div id="connectMsg" class="hint" style="margin-top:10px;"></div>
      </div>

      <!-- ACCOUNT + QUICK START -->
      <div class="row2">

        <!-- ACCOUNT -->
        <div class="card">
          <div class="sectionTitle">
            <h2>2) Account</h2>
            <div class="hint">Pulled from <code>/me</code></div>
          </div>

          <div class="kv">
            <div>
              <div class="k">Business</div>
              <div class="v" id="biz">—</div>
            </div>
            <div>
              <div class="k">Email</div>
              <div class="v" id="email">—</div>
            </div>
            <div>
              <div class="k">Plan</div>
              <div class="v" id="plan">—</div>
            </div>
            <div>
              <div class="k">Status</div>
              <div class="v" id="status">—</div>
            </div>
            <div>
              <div class="k">Renews / ends</div>
              <div class="v" id="periodEnd">—</div>
            </div>
            <div>
              <div class="k">API Base</div>
              <div class="v" id="baseEcho">—</div>
            </div>
          </div>
        </div>

        <!-- QUICK START -->
        <div class="card">
          <div class="sectionTitle">
            <h2>3) Quick start</h2>
            <div class="hint">Copy/paste into Terminal / Command Prompt</div>
          </div>

          <button class="btn" id="copyAnalyzeBtn">Copy /analyze curl</button>
          <pre class="code" id="analyzeCode">Paste your API key above to generate a ready-to-use command.</pre>

          <div style="height:10px;"></div>

          <button class="btn" id="copySummaryBtn">Copy /summary curl</button>
          <pre class="code" id="summaryCode">Paste your API key above to generate a ready-to-use command.</pre>
        </div>

      </div>

    </div>

    <div class="footer">
      © <span id="yr"></span> RestaurantAssist • Questions? <a href="mailto:support@restaurantassist.app">support@restaurantassist.app</a>
    </div>
  </div>

  <div id="toast" class="toast">Copied!</div>

  <script>
    document.getElementById("yr").textContent = new Date().getFullYear();

    const apiBaseEl = document.getElementById("apiBase");
    const apiKeyEl  = document.getElementById("apiKey");
    const pillEl    = document.getElementById("pill");
    const connectMsgEl = document.getElementById("connectMsg");

    const bizEl = document.getElementById("biz");
    const emailEl = document.getElementById("email");
    const planEl = document.getElementById("plan");
    const statusEl = document.getElementById("status");
    const periodEndEl = document.getElementById("periodEnd");
    const baseEchoEl = document.getElementById("baseEcho");

    const analyzeCodeEl = document.getElementById("analyzeCode");
    const summaryCodeEl = document.getElementById("summaryCode");

    const toastEl = document.getElementById("toast");
    function toast(text="Copied!"){
      toastEl.textContent = text;
      toastEl.classList.add("show");
      setTimeout(()=>toastEl.classList.remove("show"), 900);
    }

    function setPillNotConnected(){
      pillEl.className = "pill warn";
      pillEl.textContent = "● Not connected";
    }
    function setPillConnectedActive(){
      pillEl.className = "pill ok";
      pillEl.textContent = "● Connected (active)";
    }
    function setPillConnectedInactive(status){
      pillEl.className = "pill warn";
      pillEl.textContent = `● Connected (${status || "inactive"})`;
    }

    function buildCurlSamples(){
      const base = apiBaseEl.value.trim().replace(/\/+$/, "");
      const key = apiKeyEl.value.trim();

      if (!key){
        analyzeCodeEl.textContent = "Paste your API key above to generate a ready-to-use command.";
        summaryCodeEl.textContent = "Paste your API key above to generate a ready-to-use command.";
        return;
      }

      analyzeCodeEl.textContent =
`curl -X POST "${base}/analyze" \\
  -H "Content-Type: application/json" \\
  -H "x-api-key: ${key}" \\
  -d "{\\"review_text\\":\\"The food was great but the wait was long\\", \\"platform\\":\\"google\\"}"`;

      summaryCodeEl.textContent =
`curl "${base}/summary" \\
  -H "x-api-key: ${key}"`;
    }

    apiBaseEl.addEventListener("input", buildCurlSamples);
    apiKeyEl.addEventListener("input", () => { setPillNotConnected(); buildCurlSamples(); });

    // Load saved key on page load
    const saved = localStorage.getItem("ra_api_key");
    if (saved) {
      apiKeyEl.value = saved;
      buildCurlSamples();
    } else {
      buildCurlSamples();
    }

    document.getElementById("saveBtn").addEventListener("click", () => {
      const key = apiKeyEl.value.trim();
      if (!key) return;
      localStorage.setItem("ra_api_key", key);
      toast("Saved locally");
    });

    document.getElementById("clearBtn").addEventListener("click", () => {
      localStorage.removeItem("ra_api_key");
      apiKeyEl.value = "";
      setPillNotConnected();
      buildCurlSamples();
      toast("Cleared");
    });

    document.getElementById("copyBtn").addEventListener("click", async () => {
      const key = apiKeyEl.value.trim();
      if (!key) return;
      await navigator.clipboard.writeText(key);
      toast("API key copied");
    });

    async function loadAccount(){
      const base = apiBaseEl.value.trim().replace(/\/+$/, "");
      const key = apiKeyEl.value.trim();

      connectMsgEl.textContent = "";

      if (!key){
        connectMsgEl.textContent = "Enter your API key first.";
        setPillNotConnected();
        return;
      }

      connectMsgEl.textContent = "Loading…";

      try {
        const res = await fetch(`${base}/me`, {
          headers: { "x-api-key": key }
        });
        const data = await res.json();

        if (!res.ok){
          connectMsgEl.textContent = data?.detail || "Failed to load account.";
          setPillConnectedInactive("unauthorized");
          return;
        }

        bizEl.textContent = data.business_id || "—";
        emailEl.textContent = data.email || "—";
        planEl.textContent = data.subscription?.plan || "—";
        statusEl.textContent = data.subscription?.status || "inactive";
        periodEndEl.textContent = data.subscription?.current_period_end || "N/A";
        baseEchoEl.textContent = base;

        if ((data.subscription?.status || "").toLowerCase() === "active"){
          setPillConnectedActive();
        } else {
          setPillConnectedInactive(data.subscription?.status);
        }

        connectMsgEl.textContent = "Loaded.";
      } catch (e){
        connectMsgEl.textContent = "Network error. Check your API base URL.";
        setPillConnectedInactive("network");
      }
    }

    document.getElementById("loadBtn").addEventListener("click", loadAccount);

    document.getElementById("copyAnalyzeBtn").addEventListener("click", async () => {
      const txt = analyzeCodeEl.textContent;
      if (!txt || txt.includes("Paste your API key")) return;
      await navigator.clipboard.writeText(txt);
      toast("Analyze curl copied");
    });

    document.getElementById("copySummaryBtn").addEventListener("click", async () => {
      const txt = summaryCodeEl.textContent;
      if (!txt || txt.includes("Paste your API key")) return;
      await navigator.clipboard.writeText(txt);
      toast("Summary curl copied");
    });
  </script>
</body>
</html>

